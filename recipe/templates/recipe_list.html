{% load static tailwind_tags %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Recipe Directory | Chef's Market</title>
    {% tailwind_css %}
</head>
<body class="bg-gray-100 min-h-screen p-8">

<div class="max-auto max-w-5xl">
    <h1 class="text-4xl font-extrabold text-gray-900 mb-8 border-b-4 border-orange-500 inline-block">Recipe Index</h1>

    <div class="space-y-12">
        {% for letter, recipes in grouped_recipes.items %}
            <section id="section-{{ letter }}" class="bg-white rounded-xl shadow-md overflow-hidden">
                <div class="bg-orange-500 px-6 py-2">
                    <h2 class="text-2xl font-bold text-white">{{ letter }}</h2>
                </div>
                
                <div class="p-6">
                    <ul id="list-{{ letter }}" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {% for recipe in recipes %}
                            <li class="border-b border-gray-100 pb-2">
                                <a href="{% url 'recipe_detail' recipe.id %}" class="text-gray-700 hover:text-orange-600 transition-colors font-medium">
                                    {{ recipe.name }}
                                </a>
                            </li>
                        {% endfor %}
                    </ul>

                    <div class="mt-6 border-t pt-4">
                        <button 
                            onclick="loadMore('{{ letter }}')"
                            id="btn-{{ letter }}"
                            data-offset="10"
                            class="text-sm font-semibold text-orange-600 hover:text-orange-800 flex items-center transition-all"
                        >
                            Not found what you want? Load More {{ letter }} recipes &darr;
                        </button>
                    </div>
                </div>
            </section>
        {% empty %}
            <p class="text-gray-500 italic">No recipes found in the market yet.</p>
        {% endfor %}
    </div>
</div>

<script>
function loadMore(letter) {
    const button = document.getElementById(`btn-${letter}`);
    const list = document.getElementById(`list-${letter}`);
    const offset = parseInt(button.getAttribute('data-offset'));

    // Construct the URL (matches your urls.py path)
    const url = `/load-more-recipes/?letter=${letter}&offset=${offset}`;

    button.innerText = "Searching...";

    fetch(url)
        .then(response => response.json())
        .then(data => {
            if (data.recipes.length > 0) {
                data.recipes.forEach(recipe => {
                    const li = document.createElement('li');
                    li.className = "border-b border-gray-100 pb-2";
                    // Note: Update '/recipe/' to match your detail URL pattern
                    li.innerHTML = `
                        <a href="/recipe/${recipe.id}/" class="text-gray-700 hover:text-orange-600 transition-colors font-medium">
                            ${recipe.name}
                        </a>`;
                    list.appendChild(li);
                });

                // Update offset for next click
                button.setAttribute('data-offset', offset + 10);
                button.innerHTML = `Not found what you want? Load More ${letter} recipes &darr;`;
            }

            // If backend says no more data, hide the button
            if (!data.has_more) {
                button.parentElement.innerHTML = `<span class="text-xs text-gray-400 uppercase tracking-widest">End of ${letter} section</span>`;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            button.innerText = "Error loading. Try again.";
        });
}
</script>

</body>
</html>